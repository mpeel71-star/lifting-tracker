<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lifting Tracker</title>
  <link rel="stylesheet" href="style.css?v=10" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
  <div class="app">
    <!-- Top bar -->
    <header class="topbar">
      <div class="brand">
        <div class="logo">üèãÔ∏è</div>
        <div>
          <div class="title">Lifting Tracker</div>
          <div class="subtitle" id="activeRoutineLabel"></div>
          <div class="subtitle" id="cloudLabel">Local mode</div>
        </div>
      </div>

      <div class="top-actions">
        <button class="btn ghost" id="btnExport">Export JSON</button>
        <label class="btn ghost file">
          Import JSON
          <input id="fileImport" type="file" accept="application/json" />
        </label>
      </div>
    </header>

    <!-- Local lock -->
    <section id="loginView" class="card">
      <h2>Enter Password</h2>
      <p class="muted">Simple local lock (local only). Default: <b>lift</b></p>
      <div class="row wrap">
        <input id="pwInput" type="password" placeholder="Password" />
        <button id="pwBtn" class="btn primary">Unlock</button>
      </div>
      <p id="pwMsg" class="msg error"></p>
    </section>

    <!-- Firebase Auth / Cloud Sync -->
    <section class="card" id="authCard">
      <h2>Cloud Sync (Firebase)</h2>
      <p class="muted">
        Sign in to sync routines + workout history across devices. Local storage remains as a backup.
      </p>

      <div class="row wrap">
        <input id="fbEmail" type="email" placeholder="Email" />
        <input id="fbPassword" type="password" placeholder="Password" />
        <button class="btn" id="fbSignUp">Create account</button>
        <button class="btn" id="fbSignIn">Sign in</button>
        <button class="btn danger" id="fbSignOut" style="display:none;">Sign out</button>
      </div>

      <details class="mt" id="fbAdvanced">
        <summary>Advanced</summary>
        <div class="row wrap mt">
          <button class="btn ghost" id="btnPushCloud" style="display:none;">Push local ‚Üí cloud</button>
          <button class="btn ghost" id="btnPullCloud" style="display:none;">Pull cloud ‚Üí local</button>
          <button class="btn ghost" id="btnUseLocal">Use local (overwrite in-app)</button>
        </div>
        <p class="muted tiny">
          ‚ÄúPull‚Äù replaces your local backup with cloud. ‚ÄúPush‚Äù replaces cloud with your current local data.
        </p>
      </details>

      <div class="msg error" id="fbMsg"></div>
      <div class="msg ok" id="fbStatus"></div>
    </section>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab active" data-tab="log">Log</button>
      <button class="tab" data-tab="routines">Routines</button>
      <button class="tab" data-tab="history">History</button>
      <button class="tab" data-tab="reports">Reports</button>
    </nav>

    <!-- Main app -->
    <main id="mainView" class="main">
      <!-- LOG -->
      <section class="panel active" data-panel="log">
        <div class="card">
          <h2>Start a Workout</h2>
          <div class="row wrap">
            <label class="field">
              <span class="label">Day</span>
              <select id="logDay"></select>
            </label>

            <label class="chip">
              <input type="checkbox" id="logCompoundOnly" />
              Compound only
            </label>

            <button class="btn" id="btnStartWorkout">Start workout</button>
            <button class="btn ghost" id="btnClearWorkout">Clear</button>
            <button class="btn" id="btnSaveWorkout">Save workout</button>
          </div>

          <div class="muted tiny mt" id="logHint">
            Exercise titles show PR: <b>top weight</b> + <b>best reps at that weight</b>. Enter a weight to see your best reps ever at that weight.
          </div>
        </div>

        <div class="card" id="workoutCard">
          <h2>Workout</h2>
          <div id="workoutList" class="list"></div>
        </div>
      </section>

      <!-- ROUTINES -->
      <section class="panel" data-panel="routines">
        <div class="card">
          <h2>Routines</h2>
          <p class="muted">Keep old routines. Clone active to create a new version, then swap exercises.</p>

          <div class="row wrap">
            <button class="btn" id="btnNewRoutine">New routine</button>
            <button class="btn" id="btnCloneRoutine">Clone active</button>
            <button class="btn ghost" id="btnRenameRoutine">Rename active</button>
            <button class="btn danger" id="btnDeleteRoutine">Delete active</button>
          </div>

          <div class="row wrap mt">
            <label class="field">
              <span class="label">Active routine</span>
              <select id="routineSelect"></select>
            </label>
            <button class="btn" id="btnSetActive">Set active</button>

            <label class="field">
              <span class="label">Day</span>
              <select id="routineDay"></select>
            </label>
            <button class="btn ghost" id="btnAddDay">+ Day</button>
            <button class="btn danger" id="btnDeleteDay">Delete day</button>
          </div>

          <div class="row wrap mt">
            <input id="newExerciseName" placeholder="Add exercise (e.g., Bench Press)" />
            <select id="newExerciseTag">
              <option value="compound">compound</option>
              <option value="accessory">accessory</option>
            </select>
            <button class="btn" id="btnAddExercise">Add</button>

            <label class="chip">
              <input type="checkbox" id="routineCompoundOnly" />
              View compound only
            </label>
          </div>

          <div class="divider"></div>
          <div id="routineExercises" class="list"></div>

          <div class="divider"></div>
          <h3>Swap an Exercise</h3>
          <p class="muted tiny">Swap within the selected routine/day only.</p>
          <div class="row wrap">
            <select id="swapFrom"></select>
            <input id="swapTo" placeholder="New exercise name" />
            <select id="swapTag">
              <option value="compound">compound</option>
              <option value="accessory">accessory</option>
            </select>
            <button class="btn" id="btnSwap">Swap</button>
          </div>

          <div class="divider"></div>
          <h3>Local password</h3>
          <p class="muted tiny">Optional: change local password.</p>
          <div class="row wrap">
            <input id="newPw" type="password" placeholder="New password" />
            <button class="btn ghost" id="setPwBtn">Set Password</button>
          </div>
        </div>
      </section>

      <!-- HISTORY -->
      <section class="panel" data-panel="history">
        <div class="card">
          <h2>History</h2>
          <div class="row wrap">
            <button id="exportJsonBtn" class="btn ghost">Export JSON</button>
            <button id="exportCsvBtn" class="btn ghost">Export CSV</button>
            <button id="clearAllBtn" class="btn danger">Clear ALL Data</button>
            <input id="historySearch" placeholder="Search exercise‚Ä¶" />
            <button class="btn ghost" id="btnClearHistorySearch">Clear</button>
          </div>
          <div id="historyList" class="list"></div>
        </div>
      </section>

      <!-- REPORTS -->
      <section class="panel" data-panel="reports">
        <div class="card">
          <h2>Reports</h2>
          <div class="row wrap">
            <label class="chip">
              <input type="checkbox" id="reportCompoundOnly" />
              Compound only
            </label>
            <label class="field">
              <span class="label">Metric</span>
              <select id="reportMetric">
                <option value="e1rm">Estimated 1RM (best set)</option>
                <option value="topWeight">Top weight (best set)</option>
                <option value="volume">Total volume (sum weight√óreps)</option>
              </select>
            </label>
            <label class="field">
              <span class="label">Exercise</span>
              <select id="reportExercise"></select>
            </label>
          </div>

          <div class="mt muted" id="reportSummary"></div>
          <div class="divider"></div>
          <div id="reportTable" class="list"></div>
        </div>

        <div class="card">
          <h2>Trend Chart</h2>
          <canvas id="reportChart" height="220"></canvas>
          <p class="muted tiny mt">Uses your best set per workout for the selected exercise.</p>
        </div>
      </section>
    </main>

    <footer class="footer muted tiny">
      Local backup in your browser + optional Firebase cloud sync. Export JSON anytime to migrate.
    </footer>
  </div>

  <script type="module" src="script.js?v=10"></script>
</body>
</html>
